(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{190:function(e,t,n){"use strict";n.r(t);var a=n(6),l=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h2",{attrs:{id:"一、漏洞环境信息"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、漏洞环境信息"}},[e._v("#")]),e._v(" 一、漏洞环境信息")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("POST: http://127.0.0.1:8080/fileupload/multipart\n")])])]),n("p",[n("strong",[e._v("payload:")]),e._v(" "),n("img",{attrs:{src:"/img/fileupload_payload.jpg",alt:""}})]),e._v(" "),n("h2",{attrs:{id:"二、修复说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、修复说明"}},[e._v("#")]),e._v(" 二、修复说明")]),e._v(" "),n("p",[n("img",{attrs:{src:"/img/fileupload_fenxi.jpg",alt:""}})]),e._v(" "),n("h4",{attrs:{id:"分析service层-public-boolean-fileuploadaction-multipartfile-file-添加修复代码前后分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分析service层-public-boolean-fileuploadaction-multipartfile-file-添加修复代码前后分析"}},[e._v("#")]),e._v(" "),n("strong",[e._v("分析service层 public Boolean fileuploadAction(MultipartFile file) 添加修复代码前后分析")])]),e._v(" "),n("p",[n("strong",[e._v("文件上传核心代码")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('    @Override\n    public Boolean fileuploadAction(MultipartFile file) throws IOException {\n        //1.获取上传文件名\n        String srcFileName = file.getOriginalFilename();\n\n        //加入安全检测控制\n        Boolean isOk = fileUploadCheck.fileTypeCheck(srcFileName);\n        if (isOk==false){\n            return false;  //名称类型检测失败则不上传\n        }\n\n        //2.获取需要上传到的路径位置\n        ServletContext servletContext = ContextLoader.getCurrentWebApplicationContext().getServletContext();\n        String path = servletContext.getRealPath("/")+File.separator+ "static";\n\n        System.out.println("文件上传到本地路径为:"+path);\n        //3.执行上传操作,最好文件随机字符串重命名处理\n        file.transferTo(new File(path+File.separator+srcFileName));\n        return true;\n    }\n')])])]),n("p",[n("strong",[e._v("文件校验代码")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('/*\n 文件上传校验\n */\n@Component\npublic class fileUploadCheck {\n    private static String[] fileType = {".txt",".jpg",".png",".doc",".docs",".gif"};\n    // 文件大小\n    static public Boolean fileSizeCheck(){\n\n        return true;\n    }\n    \n    //文件类型\n    static public Boolean fileTypeCheck(String FileName){\n        if (FileName==null){\n            return false;\n        }\n        int i = FileName.lastIndexOf(".");\n        if (i==-1){\n            return false;\n        }else{\n            String type = FileName.substring(i);\n            int j = 0;\n            for (j = 0; j < fileType.length; j++) {\n                if (type.toLowerCase().equals(fileType[j])){\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n}\n')])])]),n("p",[n("strong",[e._v("修复说明")])]),e._v(" "),n("ul",[n("li",[e._v('设置文件后缀白名单 {".txt",".jpg",".png",".doc",".docs",".gif"};')]),e._v(" "),n("li",[e._v("获取上传文件后缀名称")]),e._v(" "),n("li",[e._v("判断上传文件后缀名称是否在白名单中,是->上传保存到目标目录 否->拒绝保存操作")])]),e._v(" "),n("h2",{attrs:{id:"三、小结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、小结"}},[e._v("#")]),e._v(" 三、小结")]),e._v(" "),n("ul",[n("li",[e._v("成因：输入未校验")]),e._v(" "),n("li",[e._v("位置：Service层")]),e._v(" "),n("li",[e._v("修复：输入校验\n"),n("ul",[n("li",[e._v("文件大小")]),e._v(" "),n("li",[e._v("文件类型MIME")]),e._v(" "),n("li",[e._v("文件后缀白名单")]),e._v(" "),n("li",[e._v("文件重命名")]),e._v(" "),n("li",[e._v("限制上传目录执行")])])])])])}),[],!1,null,null,null);t.default=l.exports}}]);