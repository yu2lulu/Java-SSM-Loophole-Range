(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{188:function(t,e,n){"use strict";n.r(e);var a=n(6),s=Object(a.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"一、漏洞环境信息"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、漏洞环境信息"}},[t._v("#")]),t._v(" 一、漏洞环境信息")]),t._v(" "),n("p",[n("strong",[t._v("场景：输入域名或者ip信息通过ping检测连通性")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("http://127.0.0.1:8080/cmd/runtime?ip=localhost\nhttp://127.0.0.1:8080/cmd/processbuild?ip=localhost\n")])])]),n("p",[n("img",{attrs:{src:"/img/runtime.jpg",alt:""}}),t._v(" "),n("strong",[t._v("payload代码：")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("http://127.0.0.1:8080/cmd/runtime?ip=localhost;cat+/etc/passwd\n")])])]),n("p",[n("img",{attrs:{src:"/img/cmd_payload.jpg",alt:""}})]),t._v(" "),n("h2",{attrs:{id:"二、修复说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、修复说明"}},[t._v("#")]),t._v(" 二、修复说明")]),t._v(" "),n("p",[n("img",{attrs:{src:"/img/runtime_fenxi.jpg",alt:""}})]),t._v(" "),n("h4",{attrs:{id:"分析service层goaction添加修复后的代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分析service层goaction添加修复后的代码"}},[t._v("#")]),t._v(" "),n("strong",[t._v("分析service层goAction添加修复后的代码")])]),t._v(" "),n("p",[n("strong",[t._v("goAction")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('@Service\npublic class runTimeServiceImpl implements runTimeService {\n    @Override\n    public String goAction(String ipaddr) throws IOException {\n        //安全过滤,添加一下2行esapi过滤函数的处理\n        ipaddr= charEncoding.osCmdFilterESAPI(ipaddr);\n        System.out.println(ipaddr);\n\n        String cmds = "/sbin/ping -c 1 " + ipaddr;  //拼接命令\n        String[] cmd = new String[]{"sh","-c",cmds}; \n\n\n        //执行命令获取返回值\n        InputStream inputStream = Runtime.getRuntime().exec(cmd).getInputStream(); //执行命令并获取结果\n        StringBuilder sb = new StringBuilder();\n        int len = 0;\n        while ((len=inputStream.read())!=-1){\n            sb.append((char)len);\n        }\n        return sb.toString();\n    }\n}\n')])])]),n("p",[n("strong",[t._v("esapi代码")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("//命令执行esapi编码\nstatic public String osCmdFilterESAPI(String content){\n    UnixCodec unixCodec = new UnixCodec();\n    return ESAPI.encoder().encodeForOS(unixCodec,content); \n}\n")])])]),n("p",[n("strong",[t._v("命令语句转译过程")])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("/sbin/ping -c 1 localhost;cat /etc/passwd\n        ||\n        \\/\n\\/sbin\\/ping\\ -c\\ 1\\ localhost\\;cat\\ \\/etc\\/passwd\n")])])]),n("h2",{attrs:{id:"三、小结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、小结"}},[t._v("#")]),t._v(" 三、小结")]),t._v(" "),n("ul",[n("li",[t._v("成因：输入参数未过滤")]),t._v(" "),n("li",[t._v("位置：Service层")]),t._v(" "),n("li",[t._v("修复：输入过滤/ESAPI过滤"),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("  static public String osCmdFilterESAPI(String content){\n      UnixCodec unixCodec = new UnixCodec();\n      return ESAPI.encoder().encodeForOS(unixCodec,content);\n  }\n")])])])])])])}),[],!1,null,null,null);e.default=s.exports}}]);