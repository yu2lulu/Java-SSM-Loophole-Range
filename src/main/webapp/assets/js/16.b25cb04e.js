(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{195:function(t,e,a){"use strict";a.r(e);var r=a(6),n=Object(r.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"一、漏洞环境信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、漏洞环境信息"}},[t._v("#")]),t._v(" 一、漏洞环境信息")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("dom4j: http://127.0.0.1:8080/xxe/dom4j\njdom:  http://127.0.0.1:8080/xxe/jdom\nsax:   略\n\n")])])]),a("h4",{attrs:{id:"payload"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#payload"}},[t._v("#")]),t._v(" **payload")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/xxe_payload.jpg",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"二、修复说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、修复说明"}},[t._v("#")]),t._v(" 二、修复说明")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/xxe_fenxi.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"以dom4j分析-其他库同理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#以dom4j分析-其他库同理"}},[t._v("#")]),t._v(" 以dom4j分析,其他库同理")]),t._v(" "),a("h4",{attrs:{id:"分析controller层-public-string-dom4jaction-requestbody-string-data-添加修复代码前后分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析controller层-public-string-dom4jaction-requestbody-string-data-添加修复代码前后分析"}},[t._v("#")]),t._v(" "),a("strong",[t._v("分析Controller层 public String dom4jAction(@RequestBody String data) 添加修复代码前后分析")])]),t._v(" "),a("p",[a("strong",[t._v("XXE代码")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('\n@Controller\n@RequestMapping("/xxe")\npublic class dom4jController {\n\n    @Autowired\n    private dom4jServiceImpl dom4jserviceImpl;\n\n    @ResponseBody\n    @RequestMapping(value = "/dom4j",produces = {"application/json;charset=utf-8"})\n    public String dom4jAction(@RequestBody String data){\n        System.out.println(data);\n\n        //解析xml文件\n         SAXReader reader = new SAXReader();\n        \n        //禁止外部DTD\n        reader.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);\n        reader.setFeature("http://xml.org/sax/features/external-general-entities", false);\n        reader.setFeature("http://xml.org/sax/features/external-parameter-entities", false);\n        reader.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);\n\n        retMessage ret = new retMessage();\n        try {\n            Document document = reader.read(new InputSource(new StringReader(data)));\n            Element root=document.getRootElement();\n            String id = document.getStringValue();\n            article OneArticle = dom4jserviceImpl.getArticleById(id);\n            ret.setStatusCode(200);\n            ret.setData(OneArticle);\n            ret.setReqData(id);\n\n        } catch (DocumentException e) {\n            e.printStackTrace();\n\n            ret.setStatusCode(500);\n            ret.setData(e.getMessage());\n            ret.setReqData(data);\n        }\n        \n        return JSON.toJSONString(ret);\n    }\n}\n')])])]),a("p",[a("strong",[t._v("XML注入原理")])]),t._v(" "),a("ul",[a("li",[t._v("XML跟JSON格式一样,是前后端数据交互的格式")]),t._v(" "),a("li",[t._v("XML解析原理上是反序列化操作(XML格式字符串 => Object对象)")]),t._v(" "),a("li",[t._v("XML反序列化过程:\n"),a("img",{attrs:{src:"/img/xml_parse.jpg",alt:""}}),t._v(" "),a("ol",[a("li",[t._v("xml字符串载入XML解析器中")]),t._v(" "),a("li",[t._v("解析器构造Object对象")]),t._v(" "),a("li",[t._v("id -> &xxe;  //加载id时需要引用外部实体xxe")]),t._v(" "),a("li",[t._v("&xxe -> file:///etc/passwd  //外部实体xxe来源于文件/etc/passwd")]),t._v(" "),a("li",[t._v("id = /etc/passwd  //读取/etc/passwd文件赋值给id")])])])]),t._v(" "),a("h2",{attrs:{id:"三、小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、小结"}},[t._v("#")]),t._v(" 三、小结")]),t._v(" "),a("ul",[a("li",[t._v("成因：XML内容解析未设置禁止外部实体加载")]),t._v(" "),a("li",[t._v("位置：xml解析的位置")]),t._v(" "),a("li",[t._v("修复：设置属性禁止外部实体加载\n"),a("ul",[a("li",[t._v("本质上XXE的问题是一个配置不当的问题")])])]),t._v(" "),a("li",[t._v("XXE修复指引\n"),a("ul",[a("li",[a("a",{attrs:{href:"/attach/XML%E6%B3%A8%E5%85%A5%E4%BF%AE%E5%A4%8D%E6%8C%87%E5%BC%95.txt"}},[t._v("XML注入修复指引")])])])])])])}),[],!1,null,null,null);e.default=n.exports}}]);